<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
        <title>Wander World Login</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900" />
        <style type="text/css">
            html, body {
                margin: 0;
                padding: 0;
                height: 100%;
            }
            #panel-logo {
                margin: 0;
                padding: 0;
                position: absolute;
                display: table;
                margin: 0 auto;
                text-align: center;
                left: 50%;
                top: 50%;
                transform: translate(-50%,-50%);
            }
            #panel-logo h1 {
                margin-top: 30px;
                font-family: 'Roboto', sans-serif;
                font-size: 1.1rem;
                line-height: 1.2rem;
            }
        </style>
    </head>
    <body>

        <div id="panel-logo">
            <svg height="79" width="200" viewBox="0 0 282.334 111.402">
                <defs>
                    <linearGradient id="linear-gradient" x1="0.5" x2="0.5" y1="-0.718" y2="4.587">
                        <stop offset="0" stop-color="#fe693c"/>
                        <stop offset="0.5" stop-color="#ff2c55"/>
                        <stop offset="0.67" stop-color="#ff285e"/>
                        <stop offset="0.94" stop-color="#ff1c76"/>
                        <stop offset="1" stop-color="#ff197d"/>
                    </linearGradient>
                    <linearGradient id="linear-gradient-2" x1="0.5" x2="0.5" y1="-0.659" y2="1.046">
                        <stop offset="0" stop-color="#fe693c" />
                        <stop offset="0.5" stop-color="#ff2c55" />
                        <stop offset="0.67" stop-color="#ff285e" />
                        <stop offset="0.94" stop-color="#ff1c76" />
                        <stop offset="1" stop-color="#ff197d" />
                    </linearGradient>
                    <linearGradient id="linear-gradient-3" x1="0.5" x2="0.5" y1="-1.162" y2="4.143">
                        <stop offset="0" stop-color="#fe693c" />
                        <stop offset="0.5" stop-color="#ff2c55" />
                        <stop offset="0.67" stop-color="#ff285e" />
                        <stop offset="0.94" stop-color="#ff1c76" />
                        <stop offset="1" stop-color="#ff197d" />
                    </linearGradient>

                </defs>
                <g transform="translate(.029)">
                    <g transform="translate(-.029)">
                        <g fill="#000">
                            <path d="M2.017 139.762h2.208a2.006 2.006 0 0 1 2.214 2.006l2.145 20.649c.046.319.2.481.5.481s.441-.162.487-.458l3.75-18.74c.551-2.812 2.209-3.942 5.252-3.942s4.7 1.13 5.275 3.942l3.752 18.74c.046.3.186.458.487.458s.458-.162.5-.481l2.145-20.649a2.006 2.006 0 0 1 2.214-2.006h2.22a1.812 1.812 0 0 1 2.006 2.232l-2.487 21.872c-.487 4.539-2.284 6.272-6.041 6.272s-5.345-1.739-6.2-6.272l-3.183-15.9c-.116-.713-.388-.945-.69-.945s-.551.232-.69.945l-3.159 15.9c-.852 4.539-2.441 6.272-6.22 6.272S2.985 168.4 2.5 163.866l-2.51-21.872a1.828 1.828 0 0 1 2.027-2.232z" transform="translate(.029 -58.737)"/>
                            <path d="M91.09 160.468v7.583c0 4.794-2.185 6.614-7.142 6.614h-5.217c-5.623 0-9.061-1.5-9.061-6.916s3.478-6.956 9.061-6.956h5.954v-.371c0-2.533-2.006-3.641-5.368-3.641a31.929 31.929 0 0 0-5.948.713c-1.449.278-2.319-.388-2.319-1.867v-.852a2.333 2.333 0 0 1 2.209-2.394 34.784 34.784 0 0 1 6.985-.812c6.237.047 10.846 2.702 10.846 8.899zm-6.406 7.281v-2.319h-5.646c-2.788 0-3.362.643-3.362 2.348s.58 2.319 3.339 2.319h3.368c1.971.003 2.301-.797 2.301-2.347z" transform="translate(-29.265 -63.704)"/>
                            <path id="Trazado_5120" d="M137.549 162.322V172.6a1.919 1.919 0 0 1-2.116 2.122h-2.168a1.919 1.919 0 0 1-2.122-2.122v-10.37c0-4.058-1.472-5.183-4.933-5.183s-4.927 1.13-4.927 5.183v10.37a1.919 1.919 0 0 1-2.122 2.122h-2.168a1.919 1.919 0 0 1-2.122-2.122v-10.278c0-8.272 4.174-10.672 11.339-10.672s11.339 2.4 11.339 10.672z" transform="translate(-48.258 -63.738)"/>
                            <path id="Trazado_5121" d="M179.659 135.781h2.162a1.919 1.919 0 0 1 2.122 2.122v23.322c0 5.165-2.9 7.241-9.612 7.241-8.087 0-12.881-3-12.881-11.756s4.794-11.733 12.881-11.733c1.014 0 2.1.046 3.206.139V137.9a1.919 1.919 0 0 1 2.122-2.122zm-2.122 24.469v-9.629a27.9 27.9 0 0 0-3.594-.272c-4.29 0-6.087 1.519-6.087 6.377s1.8 6.377 6.041 6.377c3.269-.035 3.64-.98 3.64-2.852z" transform="translate(-67.839 -57.063)"/>
                            <path id="Trazado_5122" d="M224.235 165.465l-9.751 1.014c.835 2.58 2.928 3.478 5.994 3.478a23.056 23.056 0 0 0 5.281-.736c1.5-.348 2.394.3 2.394 1.8v.69a2.22 2.22 0 0 1-1.8 2.377 27.288 27.288 0 0 1-7.009 1.014c-6.956 0-11.658-3.8-11.658-11.733 0-7.49 3.959-11.756 11.7-11.756 6.5 0 10.348 3.043 10.348 8.806.008 3.249-1.349 4.605-5.499 5.046zm-.551-5.623c0-2.191-1.339-3.368-4.29-3.368-3.2 0-4.91 1.455-5.252 5.351l7.948-.806c1.339-.14 1.594-.395 1.594-1.177z" transform="translate(-87.274 -63.721)"/>
                            <path id="Trazado_5123" d="M266.741 154.109v1.339c0 1.357-.806 2.116-2.319 2.139-4.841.07-5.049.487-5.049 2.214v12.951a1.919 1.919 0 0 1-2.122 2.122h-2.278a1.919 1.919 0 0 1-2.122-2.122v-13.873c0-5.275 1.89-6.707 11.64-6.87 1.467-.009 2.25.714 2.25 2.1z" transform="translate(-106.25 -63.889)"/>
                            <path id="Trazado_5124" d="M282.99 139.762h2.21a2.006 2.006 0 0 1 2.215 2.006l2.145 20.649c.046.319.2.481.5.481s.441-.162.487-.458l3.768-18.736c.551-2.812 2.209-3.942 5.252-3.942s4.7 1.13 5.275 3.942l3.758 18.736c.046.3.186.458.487.458s.458-.162.5-.481l2.145-20.649a2.006 2.006 0 0 1 2.215-2.006h2.209a1.812 1.812 0 0 1 2.006 2.232l-2.487 21.872c-.487 4.539-2.284 6.272-6.041 6.272s-5.345-1.739-6.2-6.272l-3.183-15.9c-.116-.713-.388-.945-.69-.945s-.58.232-.69.945l-3.159 15.9c-.852 4.539-2.441 6.272-6.22 6.272s-5.53-1.739-6.017-6.272l-2.5-21.872a1.814 1.814 0 0 1 2.015-2.232z" transform="translate(-118.07 -58.737)"/>
                            <path id="Trazado_5125" d="M350.18 163.406c0-7.49 4.122-11.756 11.658-11.756s11.664 4.267 11.664 11.756-4.128 11.733-11.664 11.733-11.658-4.266-11.658-11.733zm16.811 0c0-4.47-1.71-6.377-5.165-6.377s-5.159 1.89-5.159 6.377 1.7 6.336 5.159 6.336S367 167.83 367 163.406z" transform="translate(-147.162 -63.738)"/>
                            <path id="Trazado_5126" d="M411.733 154.109v1.339c0 1.357-.812 2.116-2.319 2.139-4.841.07-5.049.487-5.049 2.214v12.951a1.919 1.919 0 0 1-2.116 2.122h-2.3a1.919 1.919 0 0 1-2.122-2.122v-13.873c0-5.275 1.89-6.707 11.641-6.87 1.476-.009 2.265.714 2.265 2.1z" transform="translate(-167.184 -63.889)"/>
                            <path id="Trazado_5127" d="M430.647 135.781h2.284a1.919 1.919 0 0 1 2.122 2.122v28.023a1.919 1.919 0 0 1-2.122 2.122h-2.284a1.919 1.919 0 0 1-2.116-2.122V137.9a1.919 1.919 0 0 1 2.116-2.122z" transform="translate(-180.087 -57.063)"/>
                            <path id="Trazado_5128" d="M466.379 135.781h2.168a1.919 1.919 0 0 1 2.122 2.122v23.322c0 5.165-2.9 7.241-9.612 7.241-8.116 0-12.887-3-12.887-11.756s4.794-11.733 12.887-11.733c1.015 0 2.1.046 3.2.139V137.9a1.919 1.919 0 0 1 2.122-2.122zm-2.122 24.469v-9.629a27.824 27.824 0 0 0-3.594-.272c-4.284 0-6.081 1.519-6.081 6.377s1.8 6.377 6.035 6.377c3.275-.035 3.64-.98 3.64-2.852z" transform="translate(-188.346 -57.063)"/>
                        </g>
                        <g id="Icono_wander_">
                            <circle id="Elipse_564" cx="7.142" cy="7.142" r="7.142" transform="translate(103.883)" fill="url(#linear-gradient)"/>
                            <path id="Trazado_5129" fill="url(#linear-gradient-2)" d="M253.76 39.982v14.777a22.4 22.4 0 0 1-22.093 22.5 22.1 22.1 0 0 1-12.867-4.008 4.058 4.058 0 0 0-4.638 0 22.1 22.1 0 0 1-12.881 4.017 22.4 22.4 0 0 1-22.075-22.5V39.982a7.142 7.142 0 0 1 7.142-7.142 7.142 7.142 0 0 1 7.113 7.142v15.072a7.93 7.93 0 0 0 8.522 7.907 8.029 8.029 0 0 0 7.345-8.075V46.33a7.136 7.136 0 0 1 7.142-7.142 7.136 7.136 0 0 1 7.136 7.142v8.539a8.058 8.058 0 0 0 8.116 8.116 7.93 7.93 0 0 0 7.768-7.93V39.982a7.148 7.148 0 0 1 7.142-7.142 7.148 7.148 0 0 1 7.125 7.142z" transform="translate(-75.304 -13.802)"/>
                            <circle id="Elipse_565" cx="7.142" cy="7.142" r="7.142" fill="url(#linear-gradient-3)" transform="translate(134.028 6.342)"/>
                            <circle id="Elipse_566" cx="7.142" cy="7.142" r="7.142" transform="translate(164.172)" fill="url(#linear-gradient)"/>
                        </g>
                    </g>
                </g>
            </svg>
            <h1 id="text-loading">{{request()->get('access_token','') ? 'Ingresando...' : 'Conectando....'}}</h1>
        </div>
        <script type="text/javascript">
            (!!window.ReactNativeWebView) && ((function(){


                function getHashUrlVars(){
                    var vars = [], hash;
                    var hashes = window.location.href.slice(window.location.href.indexOf('#') + 1).split('&');
                    for(var i = 0; i < hashes.length; i++)
                    {
                        hash = hashes[i].split('=');
                        vars.push(hash[0]);
                        vars[hash[0]] = hash[1];
                    }
                    return vars;
                }

                // Get all URL parameters
                var allVars = getHashUrlVars();
                console.log('valrss '+ JSON.stringify(allVars));


                var accessTokenHash = allVars.access_token;

                if(accessTokenHash) {
                    window.location = "{{url()->current()}}?access_token="+accessTokenHash+"&granted_scopes="+JSON.stringify(allVars.granted_scopes);
                    return;
                }


                console.log('Yes it\'s react native');

                function statusChangeCallback(response) {
                    console.log(JSON.stringify(response) + ' <<< status');
                    if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                        FB.logout(function(responseLogout){
                            console.log(JSON.stringify(responseLogout)+'  <-------- response logout');
                            startLogin();
                        });
                    } else {
                        startLogin();
                    }
                }


                window.fbAsyncInit = function() {


                    FB.init({
                        appId      : '363122571749423',
                        cookie     : false,// Enable cookies to allow the server to access the session.
                        xfbml      : false,// Parse social plugins on this webpage.
                        version    : 'v10.0',
                    });

                    var accessToken = "{{request()->get('access_token','')}}";
                    if(accessToken) {
                        try {
                            console.log('token sent '+accessToken);
                            window.ReactNativeWebView.postMessage(JSON.stringify({
                                action: 'send_auth_token',
                                access_token: accessToken,
                            }));
                        } catch(ee) {
                            console.log('error  '+JSON.stringify(ee));
                        }
                        return;
                    }

                    FB.getLoginStatus(function(response) {
                        statusChangeCallback(response);
                    });
                };
                

                function startLogin() {
                    try {
                        FB.login(function(response) {}, {
                            scope: 'email,public_profile,user_friends',
                            return_scopes: true,
                        });
                    } catch(err) {
                        console.log('error FB.login');
                        console.log(err);
                    }
                }

                jQuery(function(){

                });
            })())

        </script>

        <!-- Load the JS SDK asynchronously -->
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    </body>
</html>

